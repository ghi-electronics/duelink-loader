import{r as e,w as a}from"./runtime-dom.esm-bundler-DNOERz_1.js";const s=new Worker(new URL(""+new URL("worker-D5fkhdrs.js",import.meta.url).href,import.meta.url));function t(t,r){const n=e([]),o=e(!1),l=e(!1),u=e(!1),c=e(!0),i=e(!1),d=e(""),v=e([]),p=e(null),g=e(0),m=e(0),_=e(0),f=e(""),k=e(""),b=e(0),w=e(""),h=e(1),y=e(0),M=e(0),x=e(0),I=e(0),P=e(0);let R=null;const L=7071,q=62208;let A=0;const E={};function U(e=!1){e&&(R=()=>r.emit("regionSelected")),s.postMessage({task:"memoryRegions"})}function O(e){n.value.push({date:new Date,error:e})}function V(e){n.value.push({date:new Date,event:e})}function C(e){let a=null;return e&&(a=++A,E[a]=e),a}return s.addEventListener("message",e=>function(e){switch(e.event){case"connected":o.value=!1,l.value=!0,V("Port connected."),0==M.value&&U(!0),y.value=1;break;case"disconnected":l.value=!1,V("Port disconnected."),v.value=[],y.value=-1,o.value=!1;break;case"erased":v.value=[],r.emit("erased");break;case"isTalking":i.value=e.value;break;case"listAllResult":r.emit("listAllResult",e);break;case"logError":O(e.message),e.message.toLowerCase().indexOf("port")>-1&&(o.value=!1);break;case"logEvent":V(e.message);break;case"memoryRegionsResult":v.value=[],e.result.shift(),e.result.forEach(e=>{if(e){const a=(e=e.match(/(\*?\d+)/gm))[0].startsWith("*");a&&(e[0]=e[0].substring(1,e[0].length)),v.value.push({current:a,index:Number(e[0]),used:Number(e[1]),total:Number(e[2])})}}),R&&(R(),R=null);break;case"output":d.value=e.value;break;case"playing":c.value=!1,u.value=!0,V("Program started.");break;case"recording":u.value=!1,c.value=!0,0===e.percent?(t.progress.style.width="0",t.progress.classList.remove("opacity-0")):t.progress.style.width=Math.trunc(e.percent)+"%";break;case"recorded":t.progress.style.width="100%",t.progress.classList.add("opacity-0"),U(!1);break;case"regionSelected":v.value.forEach(a=>a.current=a.index===e.index),U(!0);break;case"stopped":u.value=!1,c.value=!0,V("Program stopped.");break;case"version":p.value=e.value;break;case"writeResult":E[e.callbackId]&&(E[e.callbackId](e.result),delete E[e.callbackId]);break;case"ConnectFailed":const a=e.message.indexOf(":");let s=e.message;-1!==a&&(s=e.message.substring(0,a)),alert(s),y.value=-2,o.value=!1;break;case"eraseall_status_dms":g.value=e.value;break;case"eraseall_vid_dms":m.value=e.value;break;case"update_driver_status":_.value=e.value;break;case"driver_ver_msg":f.value=e.value;break;case"device_name_msg":k.value=e.value;break;case"update_driver_percent_msg":b.value=e.value;break;case"update_driver_path_msg":w.value=e.value;break;case"clone_fw_progress":I.value=e.value;break;case"clone_fw_dev":P.value=e.value;break;case"clone_fw_status":x.value=e.value}}(e.data)),s.addEventListener("error",e=>{s.terminate()}),a(()=>d.value,e=>{""===e&&s.postMessage({task:"clearOutput"})}),{history:n,isBusy:o,isConnected:l,isPlaying:u,isStopped:c,isTalking:i,log:d,regions:v,version:p,eraseall_status_dms:g,eraseall_vid_dms:m,update_driver_status:_,driver_ver:f,device_name:k,progress_percent:b,update_driver_path:w,update_devaddr:h,connect_status:y,connection_mode:M,clone_fw_status:x,clone_fw_progress:I,clone_fw_dev:P,connect:async function(){!window.document.documentMode&&navigator.serial||(window.location="/browser-not-supported.html"),o.value=!0;try{await navigator.serial.requestPort({filters:[{usbVendorId:L,usbProductId:q}]})}catch(e){return O(e?.message||"Unable to request port."),o.value=!1,0}return s.postMessage({task:"connect",value:h.value}),1},disconnect:async function(){s.postMessage({task:"disconnect"})},execute:function(e){s.postMessage({task:"execute",line:e})},list:function(e=null){s.postMessage({task:"list",callbackId:C(e)})},listAll:function(){s.postMessage({task:"listAll"})},newAll:function(){s.postMessage({task:"newAll"})},play:function(){s.postMessage({task:"play"})},record:function(e){s.postMessage({task:"record",lines:e})},region:function(e){s.postMessage({task:"region",index:e})},stop:function(){s.postMessage({task:"stop"})},eraseall_dms_execute:async function(){!window.document.documentMode&&navigator.serial||(window.location="/browser-not-supported.html"),o.value=!0,s.postMessage({task:"eraseall_dms_execute_msg"})},eraseall_dms_connect:async function(){if(!window.document.documentMode&&navigator.serial||(window.location="/browser-not-supported.html"),0==l.value){try{await navigator.serial.requestPort({filters:[{usbVendorId:L,usbProductId:q},{usbVendorId:L,usbProductId:62209}]})}catch(e){return O(e?.message||"Unable to request port."),void(g.value=1)}s.postMessage({task:"eraseall_dms_connect_msg",value:h.value})}else g.value=1},driver_connect:async function(){if(!window.document.documentMode&&navigator.serial||(window.location="/browser-not-supported.html"),0==l.value){try{await navigator.serial.requestPort({filters:[{usbVendorId:L,usbProductId:q}]})}catch(e){return O(e?.message||"Unable to request port."),_.value=-1,0}s.postMessage({task:"driver_connect_msg",value:h.value}),_.value=1}else _.value=1;return 1},driver_update:async function(){1==l.value&&s.postMessage({task:"driver_connect_updadate_msg"})},sendescape:async function(){1==l.value&&s.postMessage({task:"sendescape"})},do_clone_fw:async function(e,a){1==l.value&&s.postMessage({task:"do_clone_fw",value1:e,value2:a})}}}function r(e){return{all:e=e||new Map,on:function(a,s){var t=e.get(a);t?t.push(s):e.set(a,[s])},off:function(a,s){var t=e.get(a);t&&(s?t.splice(t.indexOf(s)>>>0,1):e.set(a,[]))},emit:function(a,s){var t=e.get(a);t&&t.slice().map(function(e){e(s)}),(t=e.get("*"))&&t.slice().map(function(e){e(a,s)})}}}export{r as m,t as u};
