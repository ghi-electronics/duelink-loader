import{_ as a,e,o as t,c as l,a as s,f as i,w as n,v as u,g as o,r,h as d,i as c,t as v,n as p,u as w,j as f,b as g,F as b,k as m,l as h,m as y,d as _}from"./Footer-C6ZuY13K.js";import{u as k,_ as C,a as U}from"./useWebSerial-BBeyLYLM.js";const D=""+new URL("../img/stamp-usb-connect.webp",import.meta.url).href,E=""+new URL("../img/usbhook-rgb3.webp",import.meta.url).href,L={class:"page"},F={key:0,class:"version-select"},x=["value"],S={key:1,class:"overlay"},T={class:"dialog"},A={class:"dialog-body"},q={key:2,class:"overlay"},M={class:"dialog"},O={class:"dialog-body"},B={class:"dialog-buttons"},I={key:3,class:"overlay"},j={class:"dialog"},N={class:"dialog-body"},W={class:"dialog-buttons"},P={key:4,class:"overlay"},Y={class:"dialog"},R={class:"dialog-body"},V={class:"dialog-buttons"},$={key:5,class:"overlay"},H={class:"dialog"},z={class:"dialog-body"},G={key:0,class:"firmware-warning"},J=["href"],K={key:6,class:"overlay"},Q={class:"dialog",style:{width:"25vw"}},X={key:0,class:"fas fa-exclamation-triangle",style:{"margin-right":"8px"}},Z={class:"dialog-body"},aa={class:"progress-text"},ea={class:"update-driver-progress-container"},ta={class:"progress-text"},la="Firmware detected.",sa=2048,ia=134217728;_(a({__name:"update",setup(a){const _=k();e(async()=>{await async function(){try{const a=await fetch("https://raw.githubusercontent.com/ghi-electronics/duelink-website/refs/heads/dev/static/duelink-fw.json"),e=await a.json();Object.keys(e).forEach(a=>{Fa[a]=e[a],Fa[a].isGlb=!1,Fa[a].image=null})}catch(a){}}()});const na=y(""),ua=y(""),oa=y(""),ra=y(""),da=y("");function ca(a){return new Promise(e=>setTimeout(e,a))}const va=y(!1),pa=y(!1),wa=y(!1),fa=y(!1),ga=y(!1),ba=y(!1),ma=y(0),ha=y(la);async function ya(){for(va.value=!1,ma.value=0,oa.value="Erase All",ua.value="Erasing....",ga.value=!0,await _.eraseall_dms_execute();_.eraseall_status_dms.value<2;)await ca(250),ma.value=50;ma.value=100,oa.value="Done",await ca(250),ga.value=!1,ra.value="Erase all completed.",pa.value=!0}async function _a(){va.value=!1,_.isConnected&&(await _.disconnect(),await ca(250))}async function ka(){if(fa.value=!1,!_.isConnected.value){_.device_name.value="",_.driver_ver.value="",_.progress_percent.value=0,ma.value=0,_.update_driver_status.value=0,_.update_devaddr.value=1,_.connection_mode.value=1;if(await _.driver_connect()){for(oa.value="Driver Update",ua.value="Connecting...",ga.value=!0,ma.value=0;0==_.update_driver_status.value;)await ca(100),ma.value=_.progress_percent.value;if(await ca(100),1==_.update_driver_status.value){let a=!1;const e=Date.now()+4e3;for(;!(_.isConnected.value&&""!=_.device_name.value&&""!=_.driver_ver.value||(await ca(100),Date.now()>e));)ma.value=_.progress_percent.value;_.isConnected.value&&Date.now()<e&&(a=!0),a&&(xa.value="Device Name: "+_.device_name.value,Sa.value="Firmware Version: "+_.version.value,ba.value=!0,ma.value=100,ga.value=!1)}ga.value=!1,ma.value=0}}}async function Ca(){for(ba.value=!1,oa.value="Driver Update",ua.value="Writing driver...",ga.value=!0,_.progress_percent.value=0,ma.value=0,_.driver_update();100!=_.progress_percent.value;)await ca(1),ma.value=_.progress_percent.value;_.update_driver_status.value=0,await _.disconnect(),await ca(10),ga.value=!1,ra.value="Load driver completed.",pa.value=!0}async function Ua(){_.isConnected.value&&(_.disconnect(),await ca(100)),ba.value=!1}async function Da(){if(oa.value="Update Chain",0==_.isConnected.value&&await async function(){if(_.connect_status.value=0,_.connection_mode.value=0,_.update_driver_status.value=0,ma.value=0,_.progress_percent.value=0,await _.connect()){for(ua.value="Connecting to device 1...",ga.value=!0,ma.value=0;0==_.connect_status.value&&(await ca(100),ma.value=_.progress_percent.value,71!=ma.value););_.connect_status.value>0&&(ma.value=99,await ca(100)),ga.value=!1,ma.value=0,await ca(100),_.connect_status.value<0&&(da.value="Connection failed",wa.value=!0)}}(),0!=_.isConnected.value){for(_.clone_fw_status.value=0,ua.value="Please wait...",ga.value=!0,_.progress_percent.value=0,ma.value=0,_.do_clone_fw(1,200),_.progress_percent.value=0;0==_.clone_fw_status.value;)await ca(100),ua.value=_.progress_body_text.value,ma.value=_.progress_percent.value;await ca(100),ga.value=!1,_.disconnect(),_.clone_fw_status.value>1?(2==_.clone_fw_status.value?ra.value=`A total of ${_.clone_fw_status.value-1} device was successfully cloned and its driver updated.`:ra.value=`A total of ${_.clone_fw_status.value-1} devices were successfully cloned and had their drivers updated.`,pa.value=!0):(da.value="No devices were cloned successfully.",wa.value=!0)}}let Ea;const La=y(!1),Fa=m({}),xa=y(""),Sa=y(""),Ta=h(()=>Fa.DUELink),Aa=y(0),qa=h(()=>Ta.value?.versions?[...Ta.value.versions].sort((a,e)=>e.id-a.id):[]),Ma=h(()=>qa.value[Aa.value]||null),Oa=y(!0);async function Ba(){const a=Ta;await async function(a){try{0!==(await Wa()).status&&(await Ea.controlTransferOut({requestType:"class",recipient:"interface",request:4,value:0,index:0}),await ca(100));const e=a.byteLength;await async function(a){na.value="Erasing...",ua.value=na.value;const e=Math.ceil(a/sa);for(let t=0;t<e;t++){const a=ia+t*sa,l=new Uint8Array(5);l[0]=65,l[1]=255&a,l[2]=a>>8&255,l[3]=a>>16&255,l[4]=a>>24&255,await Na(0,l),await Pa(),ja(t,e)}na.value="Erased.",ua.value=na.value,ja(0,100)}(e),ma.value=0,ga.value=!1,await ca(250),ga.value=!0,na.value="Writing...",ua.value=na.value;let t=new Uint8Array(5);t[0]=33,t[1]=0,t[2]=0,t[3]=0,t[4]=8,await Na(0,t),await Pa();let l=0,s=2;for(;l<e;){const t=a.slice(l,l+1024);await Na(s,t),await Pa(),l+=t.byteLength,s++,ja(l,e)}await async function(){let a=new Uint8Array(5);try{return a[0]=33,a[1]=0,a[2]=0,a[3]=0,a[4]=8,await Na(0,a),await Pa(),await Na(0,new ArrayBuffer(0)),await Pa(),1}catch(e){}return 0}(),na.value="Completed"}catch(e){na.value="Failed"}ua.value=na.value}(a.image)}async function Ia(){await async function(){try{La.value=!1,Ea=await navigator.usb.requestDevice({filters:[{vendorId:1155,productId:57105}]}),await Ea.open(),Ea.configuration||await Ea.selectConfiguration(1),await Ea.claimInterface(0),La.value=!0}catch(a){a.value="Connection error: "+a,La.value=!1}}(),La.value&&(ma.value=0,oa.value="Firmware Update",ua.value="Fetching firmware url...",ga.value=!0,await async function(){const a=qa?.value[Aa.value],e=a?.url;try{const a=await fetch(e);if(!a.ok)throw new Error(`HTTP ${a.status}`);const t=await a.blob(),l=await t.arrayBuffer();Ta.image=l}catch(t){Ta.image=null}}(),await Ba(),ga.value=!1,"Completed"==na.value?fa.value=!0:(da.value="Loading firmware failed!",wa.value=!0))}function ja(a,e){ma.value=Math.round(a/e*100),ma.value}async function Na(a,e){const t=await Ea.controlTransferOut({requestType:"class",recipient:"interface",request:1,value:a,index:0},e);if("ok"!==t.status)throw new Error("DNLOAD transfer failed at block "+a);return t}async function Wa(){const a=await Ea.controlTransferIn({requestType:"class",recipient:"interface",request:3,value:0,index:0},6);if("ok"===a.status&&a.data&&6===a.data.byteLength){const e=new DataView(a.data.buffer);return{status:e.getUint8(0),pollTimeout:e.getUint8(1)|e.getUint8(2)<<8|e.getUint8(3)<<16,state:e.getUint8(4),iString:e.getUint8(5)}}throw new Error("Failed to read DFU status.")}async function Pa(){for(;;){const a=await Wa();if(5===a.state||2===a.state)break;await ca(a.pollTimeout)}}return(a,e)=>(t(),l("div",L,[e[26]||(e[26]=s('<h1 class="title" data-v-8dd76b61>DUELink Loader</h1><p data-v-8dd76b61> Update modules with official firmware and drivers! </p><hr data-v-8dd76b61><h2 data-v-8dd76b61>Step 1: Erase All</h2><div class="card-container" data-v-8dd76b61><div class="card" data-v-8dd76b61><img src="'+D+'" alt="Module with USB" class="card-image" data-v-8dd76b61><p data-v-8dd76b61> Plug-in the USB cable directly... </p></div><div class="card" data-v-8dd76b61><img src="'+E+'" alt="USB Hook" class="card-image" data-v-8dd76b61><p data-v-8dd76b61> ...or use an adapter on the Uplink connector. </p></div></div><p data-v-8dd76b61> Click the <strong data-v-8dd76b61>Erase All</strong> button. The pop-up window should have a device named <em data-v-8dd76b61>DUELink Official</em> or <em data-v-8dd76b61>DUELink MicroBlocks</em>.<br data-v-8dd76b61><br data-v-8dd76b61> Select the device then click <strong data-v-8dd76b61>Connect</strong>. </p><img src="'+C+'" alt="Select COM device" data-v-8dd76b61>',7)),i("div",null,[i("button",{class:"outline-button",onClick:e[0]||(e[0]=a=>async function(){if(_.eraseall_status_dms.value=0,0==_.isConnected.value){for(_.eraseall_vid_dms.value=0,_.connection_mode.value=2,await _.eraseall_dms_connect();0==_.eraseall_status_dms.value;)await ca(100);await ca(100)}if(0!=_.eraseall_vid_dms.value){let a=65535&_.eraseall_vid_dms.value;ha.value=62208==a?"DUELink "+la:"MicroBlocks "+la,va.value=!0}}())}," Erase All ")]),e[27]||(e[27]=s('<p data-v-8dd76b61> If the pop-up window didn&#39;t show the needed device or if <strong data-v-8dd76b61>Erase All</strong> failed, your device might already be erased. Try Step 2 or visit the <a href="https://www.duelink.com/docs/loader" target="_blank" data-v-8dd76b61>loader documentation page</a>. </p><hr data-v-8dd76b61><h2 data-v-8dd76b61>Step 2: Load Firmware/Driver</h2><p data-v-8dd76b61> This step will update the firmware on a single device, or on the first device in a chain. </p><p data-v-8dd76b61> Click the button below then select the <em data-v-8dd76b61>DFU in FS Mode</em> device and click <strong data-v-8dd76b61>Connect</strong>. </p><p data-v-8dd76b61> If using Windows, <a href="https://www.duelink.com/bin/usb-drivers/win-usb-dfu.zip" target="_blank" data-v-8dd76b61>download</a> and install the DFU driver first. </p><img src="'+U+'" alt="DFU selection" data-v-8dd76b61>',7)),Ta.value?(t(),l("div",F,[e[6]||(e[6]=i("label",{for:"version-select"}," Select DUELink firmware version: ",-1)),n(i("select",{id:"version-select","onUpdate:modelValue":e[1]||(e[1]=a=>Aa.value=a)},[(t(!0),l(o,null,r(qa.value,(a,e)=>(t(),l("option",{key:a.id,value:e},v(a.name),9,x))),128))],512),[[u,Aa.value]])])):d("",!0),i("div",null,[i("button",{class:"outline-button",onClick:Ia}," Load DUELink Firmware/Driver "),e[7]||(e[7]=i("p",null,[c(" The update steps are now complete on a single device."),i("br"),i("br"),c(" Continue to step 3 if you have multiple devices in a chain that you want to update. ")],-1))]),e[28]||(e[28]=i("hr",null,null,-1)),e[29]||(e[29]=i("h2",null,"Step 3: Update Chain",-1)),e[30]||(e[30]=i("p",null," This optional step is for updating all modules in a chain (Daisylink). ",-1)),e[31]||(e[31]=i("p",null,[c(" Click the "),i("strong",null,"Load Driver Script"),c(" button, then select the device. You should only see one named "),i("em",null,"DUELink Official"),c(". ")],-1)),e[32]||(e[32]=i("img",{src:C,alt:"COM selection"},null,-1)),i("div",null,[i("button",{class:"outline-button",onClick:Da}," Update Chain ")]),e[33]||(e[33]=i("p",null,[c(" For any issues, consult the "),i("a",{href:"https://www.duelink.com/docs/loader",target:"_blank"}," loader documentation"),c(" page. ")],-1)),va.value?(t(),l("div",S,[i("div",T,[e[11]||(e[11]=i("div",{class:"dialog-title"},[i("i",{class:"fas fa-exclamation-triangle",style:{color:"yellow","margin-right":"8px"}}),c(" Warning ")],-1)),i("div",A,[i("p",null,[c(v(ha.value),1),e[8]||(e[8]=i("br",null,null,-1)),e[9]||(e[9]=i("br",null,null,-1)),c(v("Are you sure you want to erase all?")),e[10]||(e[10]=i("br",null,null,-1))])]),i("div",{class:"dialog-buttons"},[i("button",{class:"yes",onClick:ya},"Yes"),i("button",{class:"no",onClick:_a},"No")])])])):d("",!0),pa.value?(t(),l("div",q,[i("div",M,[e[12]||(e[12]=i("div",{class:"dialog-title-success"},[i("i",{class:"fas fa-check-circle",style:{color:"green","margin-right":"8px"}}),c(" Success ")],-1)),i("div",O,[i("p",null,v(ra.value),1)]),i("div",B,[i("button",{class:"no",onClick:e[2]||(e[2]=a=>{pa.value=!1})},"Close")])])])):d("",!0),wa.value?(t(),l("div",I,[i("div",j,[e[13]||(e[13]=i("div",{class:"dialog-title"},[i("i",{class:"fa-solid fa-triangle-exclamation",style:{color:"#f5c542","margin-right":"8px"}}),c(" Failed ")],-1)),i("div",N,[i("p",null,v(da.value),1)]),i("div",W,[i("button",{class:"no",onClick:e[3]||(e[3]=a=>{wa.value=!1})},"Close")])])])):d("",!0),fa.value?(t(),l("div",P,[i("div",Y,[e[17]||(e[17]=i("div",{class:"dialog-title-success"},[i("i",{class:"fas fa-question-circle",style:{color:"white","margin-right":"8px"}}),c(" Success ")],-1)),i("div",R,[i("p",null,[c(" Firmware "+v(Ma.value?.name)+" updated. ",1),e[14]||(e[14]=i("br",null,null,-1)),e[15]||(e[15]=i("br",null,null,-1)),e[16]||(e[16]=c("Do you want to load driver? ",-1))])]),i("div",V,[i("button",{class:"yes",onClick:ka},"Yes"),i("button",{class:"no",onClick:e[4]||(e[4]=a=>fa.value=!1)},"No")])])])):d("",!0),ba.value?(t(),l("div",$,[i("div",H,[e[24]||(e[24]=i("div",{class:"dialog-title"},[i("i",{class:"fas fa-exclamation-triangle",style:{color:"yellow","margin-right":"8px"}}),c(" Warning ")],-1)),i("div",z,[i("p",null,v(xa.value),1),i("p",{style:p({color:Oa.value?"#000000":"#d9534f"})},v(Sa.value),5),!1===Oa.value?(t(),l("p",G,[e[18]||(e[18]=c(" (Recommend: ",-1)),i("button",{class:"link-button underline",onClick:e[5]||(e[5]=a=>{ba.value=!1})}," Update "),e[19]||(e[19]=c(" to the latest firmware.) ",-1))])):d("",!0),e[23]||(e[23]=i("br",null,null,-1)),i("p",null,[e[20]||(e[20]=c("Do you want to load ",-1)),i("a",{target:"_blank",href:w(_).update_driver_path.value},"this driver",8,J),e[21]||(e[21]=c("?",-1)),e[22]||(e[22]=i("br",null,null,-1))])]),i("div",{class:"dialog-buttons"},[i("button",{class:"yes",onClick:Ca},"Yes"),i("button",{class:"no",onClick:Ua},"No")])])])):d("",!0),ga.value?(t(),l("div",K,[i("div",Q,[i("div",{class:f(["dialog-title",{"dialog-title-success":100===ma.value}])},[ma.value<100?(t(),l("i",X)):d("",!0),c(" "+v((ma.value,oa.value)),1)],2),i("div",Z,[i("div",aa,v(ua.value),1),e[25]||(e[25]=i("br",null,null,-1)),i("div",ea,[i("div",{class:"update-driver-progress-bar",style:p({width:ma.value+"%"})},null,4)]),i("div",ta,v(ma.value)+"% ",1)])])])):d("",!0),g(b)]))}},[["__scopeId","data-v-8dd76b61"]])).mount("#app");
