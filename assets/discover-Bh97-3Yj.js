import{_ as e,o as a,c as s,f as i,t,h as l,j as n,i as c,g as d,r as o,u as r,b as v,F as u,m as g,d as p}from"./Footer-CqatApVj.js";import{u as h}from"./useWebSerial-tOcZ_qw6.js";const m={class:"page"},_=["disabled"],f={key:0,class:"overlay"},w={class:"dialog"},b={class:"dialog-body"},k={class:"dialog-buttons"},y={key:1,class:"overlay"},C={class:"dialog"},S={class:"dialog-body"},D={class:"dialog-buttons"},$={class:"devices-wrapper"},L={class:"device-order"},j={class:"image-box"},x=["src"],F={class:"device-info"},P={class:"device-name"},V={key:0,class:"host-badge"},H={key:1,class:"host-no"},I=["href"],A={key:1,class:"device-card warning-card"};p(e({__name:"discover",setup(e){const p=h();function M(e){return new Promise(a=>setTimeout(a,e))}const N=g(!1),R=g(!1),U=g(""),B=g(""),O=g(""),Y=g(0),E=g("Discover"),T=g(!1);const W=g(!1);async function q(){T.value=!1,W.value=!0,E.value="Please wait...",p.add_device_chain_status.value=-1,await M(100);try{p.devicesChainList.value=[],await M(250);let e=0;if(p.isConnected&&(await p.disconnect(),await M(250)),e=await async function(){p.connect_status.value=0,p.connection_mode.value=0,Y.value=0,p.progress_percent.value=0,p.connect_dl_mb.value=1;let e=0;if(await p.connect()){for(U.value="Connecting to devices...",Y.value=0;0==p.connect_status.value;)if(await M(100),Y.value=p.progress_percent.value,E.value="Connecting..."+Y.value+"%",71==Y.value){e=65535&p.eraseall_vid_dms.value;break}p.connect_status.value>0&&(Y.value=99,await M(100)),Y.value=0,await M(100),p.connect_status.value<0&&(O.value=62209==e?"MicroBlocks firmware detected. The Discover feature does not support MicroBlocks firmware.":"Connection failed. If the device is running a while loop, ensure that Asio(1) is used.",R.value=!0)}return p.connect_status.value>0}(),e){for(E.value=`Scanning devices... ${Y.value}%`,await p.do_discover(),Y.value=0;-1==p.add_device_chain_status.value;)E.value=`Scanning devices... ${Y.value}%`,await M(250),Y.value++,Y.value>99&&(Y.value=99);await p.disconnect(),await M(250),E.value="Finishing...",await M(500)}}finally{if(W.value=!1,E.value="Discover",p.add_device_chain_status.value>=0&&p.devicesChainList.value.length>0){let e=p.devicesChainList.value.length;p.devicesChainList.value[e-1].host_deep>=2&&e--;const a=1===e?"1 device was detected in the chain.":`${e} devices were detected in the chain.`;B.value=a,N.value=!0,T.value=!0}}}function z(){const e=p.devicesChainList.value;if(!e||0===e.length)return;const a=[["Order","Device Name","PID","Device Address","Firmware Version","Host","Image Link","Product Detail Link"],...e.map(e=>{const a=e.parent_address>0?`H${e.parent_address}-${e.address}`:e.address;return[e.order,e.name,e.pid,a,e.firmwareVersion,e.dl_mode>0?"Yes":"No",e.image,e.detail]})].map(e=>e.map(e=>`"${e}"`).join(",")).join("\n"),s=new Blob([a],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a"),t=URL.createObjectURL(s),l=new Date,n=`duelink_devices_${String(l.getMonth()+1).padStart(2,"0")}${String(l.getDate()).padStart(2,"0")}${String(l.getFullYear()).slice(-2)}_${String(l.getHours()).padStart(2,"0")}${String(l.getMinutes()).padStart(2,"0")}${String(l.getSeconds()).padStart(2,"0")}.csv`;i.href=t,i.setAttribute("download",n),document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(t)}return(e,g)=>(a(),s("div",m,[g[9]||(g[9]=i("h1",null,"Discover",-1)),g[10]||(g[10]=i("p",null," Click Discover to scan and identify all devices in the chain. ",-1)),i("div",{class:n(["button-row",{"single-button":!T.value}])},[i("button",{class:"outline-button",onClick:q,disabled:W.value},t(E.value),9,_),T.value?(a(),s("button",{key:0,class:"outline-button",onClick:z}," Export CSV ")):l("",!0)],2),g[11]||(g[11]=i("hr",null,null,-1)),N.value?(a(),s("div",f,[i("div",w,[g[2]||(g[2]=i("div",{class:"dialog-title-success"},[i("i",{class:"fas fa-check-circle",style:{color:"green","margin-right":"8px"}}),c(" Discover ")],-1)),i("div",b,[i("p",null,t(B.value),1)]),i("div",k,[i("button",{class:"no",onClick:g[0]||(g[0]=e=>{N.value=!1})},"Close")])])])):l("",!0),R.value?(a(),s("div",y,[i("div",C,[g[3]||(g[3]=i("div",{class:"dialog-title"},[i("i",{class:"fa-solid fa-triangle-exclamation",style:{color:"#f5c542","margin-right":"8px"}}),c(" Failed ")],-1)),i("div",S,[i("p",null,t(O.value),1)]),i("div",D,[i("button",{class:"no",onClick:g[1]||(g[1]=e=>{R.value=!1})},"Close")])])])):l("",!0),i("div",$,[(a(!0),s(d,null,o(r(p).devicesChainList.value,e=>(a(),s("div",{key:e.address,class:"device-row"},[e.host_deep<2?(a(),s(d,{key:0},[i("div",L,t(e.order),1),i("div",{class:n(["device-card",{"host-card":e.dl_mode>0}])},[i("div",j,[i("img",{src:e.image,class:"device-image"},null,8,x)]),i("div",F,[i("div",P,t(e.name),1),i("div",null,[g[4]||(g[4]=i("strong",null,"PID:",-1)),c(" "+t(e.pid),1)]),i("div",null,[g[5]||(g[5]=i("strong",null,"Device Address:",-1)),c(" "+t(e.parent_address>0?`H${e.parent_address}-${e.address}`:e.address),1)]),i("div",null,[g[6]||(g[6]=i("strong",null,"Firmware Version:",-1)),c(" "+t(e.firmwareVersion),1)]),i("div",null,[g[7]||(g[7]=i("strong",null,"Host:",-1)),e.dl_mode>0?(a(),s("span",V,"Yes")):(a(),s("span",H,"No"))]),i("div",null,[i("a",{href:e.detail,target:"_blank",rel:"noopener noreferrer"}," View Product Details ",8,I)])])],2)],64)):(a(),s("div",A,[...g[8]||(g[8]=[i("div",{class:"warning-text"}," Second-level host detected. No further discovery is available. ",-1)])]))]))),128))]),v(u)]))}},[["__scopeId","data-v-bcd60efc"]])).mount("#app");
