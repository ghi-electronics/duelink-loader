import{_ as e,o as a,c as t,f as s,t as i,h as n,j as l,i as c,g as o,r as u,u as d,b as v,F as r,m as g,d as m}from"./Footer-CGfy84Zi.js";import{u as p}from"./useWebSerial-C2spa8rs.js";const _={class:"page"},h=["disabled"],f={key:0,class:"overlay"},w={class:"dialog"},b={class:"dialog-body"},k={class:"dialog-buttons"},y={class:"devices-wrapper"},C={class:"image-box"},D=["src"],S={class:"device-info"},L={key:0,class:"host-badge"},$={key:1,class:"host-no"},j=["href"];m(e({__name:"discover",setup(e){const m=p();function F(e){return new Promise(a=>setTimeout(a,e))}const V=g(!1),x=g(!1),N=g(""),P=g(""),R=g(""),U=g(0),A=g("Discover"),H=g(!1);const Y=g(!1);async function E(){H.value=!1,Y.value=!0,A.value="Please wait...",m.add_device_chain_status.value=-1,await F(100);try{m.devicesChainList.value=[],await F(250);let e=0;if(m.isConnected&&(await m.disconnect(),await F(250)),e=await async function(){if(m.connect_status.value=0,m.connection_mode.value=0,U.value=0,m.progress_percent.value=0,await m.connect()){for(N.value="Connecting to devices...",U.value=0;0==m.connect_status.value&&(await F(100),U.value=m.progress_percent.value,A.value="Connecting..."+U.value+"%",71!=U.value););m.connect_status.value>0&&(U.value=99,await F(100)),U.value=0,await F(100),m.connect_status.value<0&&(R.value="Connection failed",x.value=!0)}return m.connect_status.value>0}(),e){for(A.value="Discovering device..."+U.value+"%",await m.do_discover(),U.value=0;-1==m.add_device_chain_status.value;)A.value="Discovering device..."+U.value+"%",await F(250),U.value++,U.value>99&&(U.value=99);await m.disconnect(),await F(250),A.value="Finishing...",await F(500)}}finally{if(Y.value=!1,A.value="Discover",m.add_device_chain_status.value>0){const e=m.devicesChainList.value.length;P.value=`${e} device${1===e?"":"s"} detected in the chain.`,V.value=!0,H.value=!0}}}function I(){const e=m.devicesChainList.value;if(!e||0===e.length)return;const a=[["Device Name","Device Address","Firmware Version","Host","Image Link","Product Detail Link"],...e.map(e=>[e.name,e.address,e.firmwareVersion,e.dl_mode>0?"Yes":"No",e.image,e.detail])].map(e=>e.map(e=>`"${e}"`).join(",")).join("\n"),t=new Blob([a],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),i=URL.createObjectURL(t);s.href=i;const n=new Date,l=`duelink_devices_${String(n.getMonth()+1).padStart(2,"0")}${String(n.getDate()).padStart(2,"0")}${String(n.getFullYear()).slice(-2)}_${String(n.getHours()).padStart(2,"0")}${String(n.getMinutes()).padStart(2,"0")}${String(n.getSeconds()).padStart(2,"0")}.csv`;s.setAttribute("download",l),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(i)}return(e,g)=>(a(),t("div",_,[g[6]||(g[6]=s("h1",null,"Discover",-1)),g[7]||(g[7]=s("p",null," Click Discover to scan and identify all devices in the chain. ",-1)),s("div",{class:l(["button-row",{"single-button":!H.value}])},[s("button",{class:"outline-button",onClick:E,disabled:Y.value},i(A.value),9,h),H.value?(a(),t("button",{key:0,class:"outline-button",onClick:I}," Export CSV ")):n("",!0)],2),g[8]||(g[8]=s("hr",null,null,-1)),V.value?(a(),t("div",f,[s("div",w,[g[1]||(g[1]=s("div",{class:"dialog-title-success"},[s("i",{class:"fas fa-check-circle",style:{color:"green","margin-right":"8px"}}),c(" Discover ")],-1)),s("div",b,[s("p",null,i(P.value),1)]),s("div",k,[s("button",{class:"no",onClick:g[0]||(g[0]=e=>{V.value=!1})},"Close")])])])):n("",!0),s("div",y,[(a(!0),t(o,null,u(d(m).devicesChainList.value,e=>(a(),t("div",{key:e.address,class:l(["device-card",{"host-card":e.dl_mode>0}])},[s("div",C,[s("img",{src:e.image,class:"device-image"},null,8,D)]),s("div",S,[s("div",null,[g[2]||(g[2]=s("strong",null,"Device Name:",-1)),c(" "+i(e.name),1)]),s("div",null,[g[3]||(g[3]=s("strong",null,"Device Address:",-1)),c(" "+i(e.address),1)]),s("div",null,[g[4]||(g[4]=s("strong",null,"Firmware Version:",-1)),c(" "+i(e.firmwareVersion),1)]),s("div",null,[g[5]||(g[5]=s("strong",null,"Host:",-1)),e.dl_mode>0?(a(),t("span",L,"Yes")):(a(),t("span",$,"No"))]),s("div",null,[s("a",{href:e.detail,target:"_blank",rel:"noopener noreferrer"}," View Product Details ",8,j)])])],2))),128))]),v(r)]))}},[["__scopeId","data-v-f8bb8661"]])).mount("#app");
