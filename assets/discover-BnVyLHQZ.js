import{_ as e,o as a,c as t,f as n,t as s,h as i,j as l,g as o,r as c,i as u,u as r,b as d,F as v,m as g,d as m}from"./Footer-CGfy84Zi.js";import{u as _}from"./useWebSerial-BmLw6pnG.js";const p={class:"page"},w=["disabled"],f={class:"devices-wrapper"},h={class:"image-box"},b=["src"],D={class:"device-info"},S={key:0,class:"host-badge"},k={key:1,class:"host-no"},C=["href"];m(e({__name:"discover",setup(e){const m=_();function y(e){return new Promise(a=>setTimeout(a,e))}const L=g(!1),j=g(""),$=g(""),F=g(0),V=g("Discover"),N=g(!1);const P=g(!1);async function R(){N.value=!1,P.value=!0,V.value="Please wait...",m.add_device_chain_status.value=-1,await y(100);try{m.devicesChainList.value=[],await y(250);let e=0;if(m.isConnected&&(await m.disconnect(),await y(250)),e=await async function(){if(m.connect_status.value=0,m.connection_mode.value=0,F.value=0,m.progress_percent.value=0,await m.connect()){for(j.value="Connecting to devices...",F.value=0;0==m.connect_status.value&&(await y(100),F.value=m.progress_percent.value,V.value="Connecting..."+F.value+"%",71!=F.value););m.connect_status.value>0&&(F.value=99,await y(100)),F.value=0,await y(100),m.connect_status.value<0&&($.value="Connection failed",L.value=!0)}return m.connect_status.value>0}(),e){for(V.value="Discovering device..."+F.value+"%",await m.do_discover(),F.value=0;-1==m.add_device_chain_status.value;)V.value="Discovering device..."+F.value+"%",await y(250),F.value++,F.value>99&&(F.value=99);await m.disconnect(),await y(250),V.value="Finishing...",await y(500)}}finally{P.value=!1,V.value="Discover",m.add_device_chain_status.value>0&&(N.value=!0)}}function U(){const e=m.devicesChainList.value;if(!e||0===e.length)return;const a=[["Device Name","Device Address","Firmware Version","Host","Image Link","Product Detail Link"],...e.map(e=>[e.name,e.address,e.firmwareVersion,e.dl_mode>0?"Yes":"No",e.image,e.detail])].map(e=>e.map(e=>`"${e}"`).join(",")).join("\n"),t=new Blob([a],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a"),s=URL.createObjectURL(t);n.href=s;const i=new Date,l=`duelink_devices_${String(i.getMonth()+1).padStart(2,"0")}${String(i.getDate()).padStart(2,"0")}${String(i.getFullYear()).slice(-2)}_${String(i.getHours()).padStart(2,"0")}${String(i.getMinutes()).padStart(2,"0")}${String(i.getSeconds()).padStart(2,"0")}.csv`;n.setAttribute("download",l),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)}return(e,g)=>(a(),t("div",p,[g[4]||(g[4]=n("h1",null,"Discover",-1)),g[5]||(g[5]=n("p",null," Click Discover to scan and identify all devices in the chain. ",-1)),n("div",{class:l(["button-row",{"single-button":!N.value}])},[n("button",{class:"outline-button",onClick:R,disabled:P.value},s(V.value),9,w),N.value?(a(),t("button",{key:0,class:"outline-button",onClick:U}," Export CSV ")):i("",!0)],2),g[6]||(g[6]=n("hr",null,null,-1)),n("div",f,[(a(!0),t(o,null,c(r(m).devicesChainList.value,e=>(a(),t("div",{key:e.address,class:l(["device-card",{"host-card":e.dl_mode>0}])},[n("div",h,[n("img",{src:e.image,class:"device-image"},null,8,b)]),n("div",D,[n("div",null,[g[0]||(g[0]=n("strong",null,"Device Name:",-1)),u(" "+s(e.name),1)]),n("div",null,[g[1]||(g[1]=n("strong",null,"Device Address:",-1)),u(" "+s(e.address),1)]),n("div",null,[g[2]||(g[2]=n("strong",null,"Firmware Version:",-1)),u(" "+s(e.firmwareVersion),1)]),n("div",null,[g[3]||(g[3]=n("strong",null,"Host:",-1)),e.dl_mode>0?(a(),t("span",S,"Yes")):(a(),t("span",k,"No"))]),n("div",null,[n("a",{href:e.detail,target:"_blank",rel:"noopener noreferrer"}," View Product Details ",8,C)])])],2))),128))]),d(v)]))}},[["__scopeId","data-v-2ad3d600"]])).mount("#app");
