import{_ as e,o as a,c as s,f as t,t as i,h as n,j as l,i as c,g as d,r as o,u as r,b as v,F as u,m as g,d as p}from"./Footer-CqatApVj.js";import{u as h}from"./useWebSerial-hCfNiK1T.js";const m={class:"page"},_=["disabled"],w={key:0,class:"overlay"},f={class:"dialog"},b={class:"dialog-body"},y={class:"dialog-buttons"},k={class:"devices-wrapper"},C={class:"device-order"},D={class:"image-box"},S=["src"],L={class:"device-info"},$={class:"device-name"},j={key:0,class:"host-badge"},F={key:1,class:"host-no"},P=["href"],V={key:1,class:"device-card warning-card"};p(e({__name:"discover",setup(e){const p=h();function x(e){return new Promise(a=>setTimeout(a,e))}const H=g(!1),I=g(!1),N=g(""),R=g(""),U=g(""),A=g(0),O=g("Discover"),Y=g(!1);const E=g(!1);async function M(){Y.value=!1,E.value=!0,O.value="Please wait...",p.add_device_chain_status.value=-1,await x(100);try{p.devicesChainList.value=[],await x(250);let e=0;if(p.isConnected&&(await p.disconnect(),await x(250)),e=await async function(){if(p.connect_status.value=0,p.connection_mode.value=0,A.value=0,p.progress_percent.value=0,await p.connect()){for(N.value="Connecting to devices...",A.value=0;0==p.connect_status.value&&(await x(100),A.value=p.progress_percent.value,O.value="Connecting..."+A.value+"%",71!=A.value););p.connect_status.value>0&&(A.value=99,await x(100)),A.value=0,await x(100),p.connect_status.value<0&&(U.value="Connection failed",I.value=!0)}return p.connect_status.value>0}(),e){for(O.value="Discovering device..."+A.value+"%",await p.do_discover(),A.value=0;-1==p.add_device_chain_status.value;)O.value="Discovering device..."+A.value+"%",await x(250),A.value++,A.value>99&&(A.value=99);await p.disconnect(),await x(250),O.value="Finishing...",await x(500)}}finally{if(E.value=!1,O.value="Discover",p.add_device_chain_status.value>=0&&p.devicesChainList.value.length>0){let e=p.devicesChainList.value.length;p.devicesChainList.value[e-1].host_deep>=2&&e--;const a=1===e?"1 device was detected in the chain.":`${e} devices were detected in the chain.`;R.value=a,H.value=!0,Y.value=!0}}}function B(){const e=p.devicesChainList.value;if(!e||0===e.length)return;const a=[["Order","Device Name","PID","Device Address","Firmware Version","Host","Image Link","Product Detail Link"],...e.map(e=>{const a=e.parent_address>0?`H${e.parent_address}-${e.address}`:e.address;return[e.order,e.name,e.pid,a,e.firmwareVersion,e.dl_mode>0?"Yes":"No",e.image,e.detail]})].map(e=>e.map(e=>`"${e}"`).join(",")).join("\n"),s=new Blob([a],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a"),i=URL.createObjectURL(s),n=new Date,l=`duelink_devices_${String(n.getMonth()+1).padStart(2,"0")}${String(n.getDate()).padStart(2,"0")}${String(n.getFullYear()).slice(-2)}_${String(n.getHours()).padStart(2,"0")}${String(n.getMinutes()).padStart(2,"0")}${String(n.getSeconds()).padStart(2,"0")}.csv`;t.href=i,t.setAttribute("download",l),document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(i)}return(e,g)=>(a(),s("div",m,[g[7]||(g[7]=t("h1",null,"Discover",-1)),g[8]||(g[8]=t("p",null," Click Discover to scan and identify all devices in the chain. ",-1)),t("div",{class:l(["button-row",{"single-button":!Y.value}])},[t("button",{class:"outline-button",onClick:M,disabled:E.value},i(O.value),9,_),Y.value?(a(),s("button",{key:0,class:"outline-button",onClick:B}," Export CSV ")):n("",!0)],2),g[9]||(g[9]=t("hr",null,null,-1)),H.value?(a(),s("div",w,[t("div",f,[g[1]||(g[1]=t("div",{class:"dialog-title-success"},[t("i",{class:"fas fa-check-circle",style:{color:"green","margin-right":"8px"}}),c(" Discover ")],-1)),t("div",b,[t("p",null,i(R.value),1)]),t("div",y,[t("button",{class:"no",onClick:g[0]||(g[0]=e=>{H.value=!1})},"Close")])])])):n("",!0),t("div",k,[(a(!0),s(d,null,o(r(p).devicesChainList.value,e=>(a(),s("div",{key:e.address,class:"device-row"},[e.host_deep<2?(a(),s(d,{key:0},[t("div",C,i(e.order),1),t("div",{class:l(["device-card",{"host-card":e.dl_mode>0}])},[t("div",D,[t("img",{src:e.image,class:"device-image"},null,8,S)]),t("div",L,[t("div",$,i(e.name),1),t("div",null,[g[2]||(g[2]=t("strong",null,"PID:",-1)),c(" "+i(e.pid),1)]),t("div",null,[g[3]||(g[3]=t("strong",null,"Device Address:",-1)),c(" "+i(e.parent_address>0?`H${e.parent_address}-${e.address}`:e.address),1)]),t("div",null,[g[4]||(g[4]=t("strong",null,"Firmware Version:",-1)),c(" "+i(e.firmwareVersion),1)]),t("div",null,[g[5]||(g[5]=t("strong",null,"Host:",-1)),e.dl_mode>0?(a(),s("span",j,"Yes")):(a(),s("span",F,"No"))]),t("div",null,[t("a",{href:e.detail,target:"_blank",rel:"noopener noreferrer"}," View Product Details ",8,P)])])],2)],64)):(a(),s("div",V,[...g[6]||(g[6]=[t("div",{class:"warning-text"}," Second-level host detected. No further discovery is available. ",-1)])]))]))),128))]),v(u)]))}},[["__scopeId","data-v-296deff8"]])).mount("#app");
